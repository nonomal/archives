# moguv图元迭代方案设计

### 原则

1. 兼容存量数据

- 编辑兼容

- 预览兼容

2. 可选是否升级（渐进/优雅降级）

3. 灵活性，可扩展性

### 当前分析

1. 技术分析

   - 前端关键逻辑

   [![7KpJje.png](https://s4.ax1x.com/2022/01/12/7KpJje.png)](https://imgtu.com/i/7KpJje)

   - 业务层面

     所有可配置数据的图元均存在symbolType字段与数据源强关联

2. 产品分析
   - '通用性'能力较弱
   - 图元<->数据源之间业务耦合性高
   - 数据转换为视图的方式较为单一

### 改造预期

1. 满足前后兼容的基本原则，可选升级；
2. 具备健壮、可扩展交互面板配置能力，可插拔的图元生产能力；
3. 具备向独立产品对外服务的能力；
4. 提供必要的开发工具（cli）。

### 前置条件

#### 版本规范（参考datav）

[自定义组件-静态资源的使用和兼容更新](https://helpcdn.aliyun.com/document_detail/372608.html#title-1kp-bx1-bqs)

主版本更新：是指组件发生不兼容修改，比如组件的配置项和代码进行了大范围修改，甚至是重构，已经无法兼容时，此时主板本号X需要递增，次版本号和修订号置为0，例如：0.1.2更新到1.0.0。

次版本更新：是指组件发生兼容新功能的修改，比如组件新增了背景色的配置项，此时次版本号Y需要递增，主版本号不变，修订号置为0，例如：1.2.3更新到1.3.0。

修订号更新：是指组件只发生了代码的修正，比如组件中修改了某个配置项的属性值，此时修订号Z 需要递增，主版本号和次版本号不变，例如：1.2.3更新到1.2.4。

#### 图元开发规范

index.ts  // 入口，图元渲染逻辑 必须

properties.ts  // 图元配置（基础信息、默认值、数据映射、属性配置...）必须 

readme.md  // 功能描述 (可选)

changelog.md  // 迭代更新记录（可选）







PS:图元包生成器(cli)

#### 图元构建规范

<img src="/Users/vannvan/Downloads/图元构建规范.png" alt="图元构建规范" style="zoom: 67%;" />



### 详细设计

- 批量导出“可用”图元

  图元目录入口index.ts

  ![image-20220208174311951](/Users/vannvan/Library/Application Support/typora-user-images/image-20220208174311951.png)

- 图元主入口

  ![image-20220208174746528](/Users/vannvan/Library/Application Support/typora-user-images/image-20220208174746528.png)

- 图元主题配置结构

  ![image-20220208174630341](/Users/vannvan/Library/Application Support/typora-user-images/image-20220208174630341.png)



