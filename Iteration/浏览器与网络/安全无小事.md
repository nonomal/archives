## XSS
### 含义
`Cross Site Script`,跨站脚本攻击。是指攻击者在网站上注入恶意客户端代码，通过恶意脚本对客户端网页进行篡改，从而在用户浏览网页时，对用户浏览器进行控制或者获取用户隐私数据的一种攻击方式。
XSS 的本质是因为网站没有对恶意代码进行过滤，与正常的代码混合在一起了，浏览器没有办法分辨哪些脚本是可信的，从而导致了恶意代码的执行
### 场景举例

- 数据从一个不可靠的链接进入到一个web应用程序。
- 没有过滤掉恶意代码的动态内容被发送给web用户。
### 攻击类型
#### 存储型攻击步骤

1. 攻击者将恶意代码提交到⽬标⽹站的数据库中。
2. ⽤户打开⽬标⽹站时，⽹站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。 
3. ⽤户浏览器接收到响应后解析执⾏，混在其中的恶意代码也被执⾏。
4. 恶意代码窃取⽤户数据并发送到攻击者的⽹站，或者冒充⽤户的⾏为，调⽤⽬标⽹站接⼝执⾏攻击者指定的操作。这种攻击常⻅于带有⽤户保存数据的⽹站功能，如论坛发帖、商品评论、⽤户私信等
#### 反射性攻击步骤

1. 攻击者构造出特殊的 URL，其中包含恶意代码
2. ⽤户打开带有恶意代码的 URL 时，⽹站服务端将恶意代码从URL中取出，拼接在 HTML 中返回给浏览器。
3. ⽤户浏览器接收到响应后解析执⾏，混在其中的恶意代码也被执⾏。
4. 恶意代码窃取⽤户数据并发送到攻击者的⽹站，或者冒充⽤户的⾏为，调⽤⽬标⽹站接⼝执⾏攻击者指定的操作。
#### DOM型攻击步骤

1. 攻击者构造出特殊的 URL，其中包含恶意代码。
2. ⽤户打开带有恶意代码的 URL。
3. ⽤户浏览器接收到响应后解析执⾏，**前端JavaScript 取出URL中的恶意代码并执⾏**。
4. 恶意代码窃取⽤户数据并发送到攻击者的⽹站，或者冒充⽤户的⾏为**，调⽤⽬标⽹站接⼝执⾏攻击者指定的操作。**
### XSS攻击的区别
**不同点：**
反射型 XSS 跟存储型 XSS 的区别是：存储型XSS 的恶意代码存在数据库⾥，反射型 XSS 的恶意代码存在URL ⾥
DOM 型 XSS 跟前两种 XSS 的区别：DOM 型XSS 攻击中，取出和执⾏恶意代码由浏览器端完成，属于前端JavaScript ⾃身的安全漏洞，⽽其他两种 XSS 都属于服务端的安全漏洞。
**共同点：**
将一些隐私数据如cookie、session发送给攻击者，将受害者重定向到一个由攻击者控制的网站，在受害者机器上进行恶意操作。
### 模拟
```javascript
const Koa = require('koa');
const Router = require('koa-router');
const app = new Koa();
const router = new Router();

router.get('/', async ctx => {
  ctx.body = '<script>alert("XSS攻击")</script>';
});

app.use(router.routes())
app.listen('3000', ()=> {
  console.log('Listening 3000');
});
```
当用户点击恶意链接时，页面跳转到攻击者预先准备的页面，会发现在攻击者的页面执行了 js 脚本。这样就产生了反射型 XSS 攻击。攻击者可以注入任意的恶意脚本进行攻击，可能注入恶作剧脚本或注入能获取用户隐私数据(如cookie)的脚本。
### 防范

1. 现代主流浏览器内置CSP现代主流浏览器内置CSP

CSP本质上是建立白名单，规定了浏览器只能执行特定来源的代码。
通过 **Content-Security-Policy**HTTP头来开启CSP:

- 只允许加载本站资源Content-Security-Policy: default-src 'self'
- 只允许加载HTTPS协议图片 Content-Security-Policy: img-src https://*
- 允许加载任何来源框架 Content-Security-Policy: child-src 'none'
2. HttpOnly阻止Cookie劫持攻击HttpOnly阻止Cookie劫持攻击
3. 输入检查/XSS Filte输入检查/XSS Filte，对用户输入进行过滤，如 HTMLEncode 函数实现应该至少进行 & < > " ' / 等符号转义成 &amp &lt &gt &quot &#x27 &#x2F；
```javascript
function escape(str) {
  str = str.replace(/&/g, '&amp;');
  str = str.replace(/</g, '&lt;');
  str = str.replace(/>/g, '&gt;');
  str = str.replace(/"/g, '&quto;');
  str = str.replace(/'/g, '&##39;');
  str = str.replace(/\//g, '&##x2F;')
}
```
## CSRF
### 含义
`Cross Site Request Forgery`,CSRF 攻击指的是**跨站请求伪造**攻击，攻击者诱导用户进入一个第三方网站，然后该网站向被攻击网站发送跨站请求。如果用户在被攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作。
简单来说，**CSRF就是利用用户的登录态发起恶意请求**。
### 攻击类型

1. GET 类型的 CSRF 攻击，比如在网站中的一个img 标签里构建一个请求，当用户打开这个网站的时候就会自动发起提交。
2. POST 类型的 CSRF 攻击，比如构建一个表单，然后隐藏它，当用户进入页面时，自动提交这个表单。
3. 链接类型的 CSRF 攻击，比如在 a 标签的href 属性里构建一个请求，然后诱导用户去点击。
### 防范
防范CSRF可遵循以下几种规则:

1. 进行同源检测，服务器根据 http 请求头中`origin` 或者`referer`信息来判断请求是否为允许访问的站点，从而对请求进行过滤。(这个其实作用不是很大，因为请求头可以模拟)
2. token 验证
3.  不让第三方网站访问到用户Cookie，设置`Samesite`
4. Get 请求不对数据进行修改
## 问题
### 有哪些可能引起前端安全的问
#### 跨站脚本 (Cross-Site Scripting, XSS): 
⼀种代码注⼊⽅式,为了与 CSS 区分所以被称作 XSS。早期常⻅于⽹络论坛, 起因是⽹站没有对⽤户的输⼊进⾏严格的限制, 使得攻击者可以将脚本上传到帖⼦让其他⼈浏览到有恶意脚本的⻚⾯, 其注⼊⽅式很简单包括但不限于 JavaScript / CSS / Flash 等；
#### iframe滥用
iframe 中的内容是由第三⽅来提供的，默认情况下他们不受控制，他们可以在 iframe 中运⾏JavaScirpt 脚本、Flash插件、弹出对话框等等，这可能会破坏前端⽤户体验；
#### CSRF
指攻击者通过设置好的陷阱，强制对已完成认证的⽤户进⾏⾮预期的个⼈信息或设定信息等某些状态更新，属于被动攻击
#### 恶意第三⽅库
⽆论是后端服务器应⽤还是前端应⽤开发，绝⼤多数时候都是在借助开发框架和各种类库进⾏快速开发，⼀旦第三⽅库被植⼊恶意代码很容易引起安全问题。
### 不严格属于前端范畴的其他安全问题
#### 点击劫持
攻击者将一个透明页面覆盖在目标网站页面之上，欺骗用户点击透明页面的某个按钮来执行某个操作。
####  SQL注入
攻击者通过在用户输入字段中注入恶意SQL语句来窃取数据或进行恶意操作。
#### 不当的密码存储
将用户密码明文存储在数据库中。当数据库泄露后，攻击者可以轻松窃取用户的密码。
#### 不当的会话管理
不当的会话管理实践，如**使用相同的会话ID或不推出会话**，可能导致用户账号易受攻击。
### 网络劫持有哪几种，如何防范？

1. DNS 劫持: (输⼊京东被强制跳转到淘宝这就属于dns 劫持)
- DNS 强制解析: 通过修改运营商的本地 DNS 记录，来引导⽤户流量到缓存服务器
- 302 跳转的⽅式: 通过监控⽹络出⼝的流量，分析判断哪些内容是可以进⾏劫持处理的,再对劫持的内存发起302 跳转的回复，引导⽤户获取内容
2. HTTP 劫持: (访问⾕歌但是⼀直有贪玩蓝⽉的⼴告)，由于http明⽂传输,运营商会修改你的 http 响应内容(即加⼴告)
3. ARP劫持(地址解析协议)：攻击者欺骗受害者机器的ARP表，将正常的通信数据流量转移至攻击者控制的设备，导致用户机器只能与攻击者的设备通信。

DNS 劫持由于涉嫌违法，已经被监管起来，现在很少会有DNS劫持，⽽http 劫持依然⾮常盛⾏，最有效的办法就是全站HTTPS，将HTTP 加密，这使得运营商⽆法获取明⽂，就⽆法劫持你的响应内容。
### 攻击的其它方式

- XSS 攻击
- SQL 注入攻击

SQL注入是一种非常常见的数据库攻击手段，也是网络世界中最普遍的漏洞之一，它其实就是黑客在表单中填写包含 SQL 关键字的数据，表单数据提交给服务器时让数据库执行恶意 SQL 的过程。
例如 ' OR '1'='1 ，当我们输如用户名 admin ，然后密码输如 ' OR '1'=1='1 的时候，我们在查询用户名和密码是否正确的时候，本来要执行的是 SELECT * FROM user WHERE username='' and password='' ,经过参数拼接后，会执行 SQL语句  SELECT * FROM user WHERE username='' and password='' OR '1'='1' ，这个时候1=1是成立，自然就跳过验证了。

- DDoS 攻击

Dos 拒绝服务攻击（Denial of Service attack）是一种能够让服务器呈现静止状态的攻击方式。其原理就是发送大量的合法请求到服务器，服务器无法分辨这些请求是正常请求还是攻击请求，所以会照单全收。海量的请求造成服务器进入停止工作或拒绝服务的状态。
DDoS：分布式拒绝服务攻击（Distributed Denial of Service），DDos攻击是在 DOS 攻击基础上的，可以通俗理解，dos 是单挑，而 ddos 是群殴，因为现代技术的发展，dos攻击的杀伤力降低，所以出现了DDOS，攻击者借助公共网络，将大数量的计算机设备联合起来，向一个或多个目标进行攻击。
为了防御 DDoS 攻击，阿里巴巴的安全团队在实战中发现，需要做的就是检测技术和清洗技术，检测技术就是检测网站是否正在遭受 DDoS 攻击，而清洗技术就是清洗掉异常流量。这里不做引伸

- 上传文件漏洞

如果 web 网站没有对文件类型进行严格的校验，导致可执行文件被恶意上传到了服务器，恶意脚本就会执行

- DNS 查询攻击
## 资料

- [https://coffe1891.gitbook.io/frontend-hard-mode-interview/1/1.5.5](https://coffe1891.gitbook.io/frontend-hard-mode-interview/1/1.5.5)
- [跨站脚本功攻击，xss，一个简单的例子让你知道什么是xss攻击](https://www.cnblogs.com/Renyi-Fan/p/9951407.html)
- [带你分析CSRF攻击技术场景_csrf存在的地方](https://blog.csdn.net/kali_Ma/article/details/117789883)
- [一文搞懂ARP欺骗原理和DNS劫持原理](https://www.jianshu.com/p/01c25d469434)
- [我在实验室电脑上玩Kali（中间人攻击、ARP，顺便断了同学的网）](https://zhuanlan.zhihu.com/p/441180960)
- [二、web安全（xss/csrf）简单攻击原理和防御方案（实战篇） - 掘金](https://juejin.cn/post/6953059119561441287)
- [除了CSRF，你还知道其它的攻击方式吗？ · Issue #102 · sisterAn/blog](https://github.com/sisterAn/blog/issues/102)
- [前端安全](https://www.yuque.com/asuncat/security) ⭐️
